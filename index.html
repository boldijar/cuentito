<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Spanish Stories</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; margin: 0; padding: 1.5rem; background: #f5f5f5; color: #1a1a1a; }
    h1 { margin: 0 0 1.5rem; font-size: 1.5rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; max-width: 1200px; margin: 0 auto; }
    .card { display: block; text-decoration: none; color: inherit; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s, box-shadow 0.2s; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.12); }
    .card-bg { position: relative; height: 140px; background-size: cover; background-position: center; background-color: #e0e0e0; }
    .card-bg img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .card-bg .level { position: absolute; top: 0.5rem; right: 0.5rem; background: rgba(0,0,0,0.7); color: #fff; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }
    .card-body { padding: 1rem; }
    .card-title { margin: 0; font-size: 1.05rem; line-height: 1.35; }
    .card-meta { margin-top: 0.5rem; font-size: 0.85rem; color: #666; }
    .loading { text-align: center; padding: 2rem; color: #666; }
    .error { color: #c00; padding: 1rem; }
  </style>
</head>
<body>
  <h1>Spanish Stories</h1>
  <div id="app" class="loading">Loading storiesâ€¦</div>

  <script>
    (function () {
      var app = document.getElementById('app');

      function escapeHtml(s) {
        if (s == null) return '';
        var div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
      }

      function getQuery() {
        var q = {};
        (window.location.search || '').replace(/^\?/, '').split('&').forEach(function (p) {
          var kv = p.split('=');
          if (kv.length === 2) q[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]);
        });
        return q;
      }

      fetch('stories/manifest.json')
        .then(function (r) { return r.ok ? r.json() : Promise.reject(new Error('No manifest')); })
        .then(function (names) {
          if (!names || !names.length) { app.innerHTML = '<p class="error">No stories found.</p>'; app.className = ''; return; }
          return Promise.all(names.map(function (name) {
            return fetch('stories/' + name + '.json').then(function (r) {
              if (!r.ok) return null;
              return r.json().then(function (data) { return { name: name, data: data }; });
            }).catch(function () { return null; });
          })).then(function (results) {
            var list = results.filter(Boolean);
            if (!list.length) { app.innerHTML = '<p class="error">Could not load any story.</p>'; app.className = ''; return; }
            var html = '<div class="grid">';
            list.forEach(function (item) {
              var d = item.data;
              var thumb = d.thumbnail && d.thumbnail.filename ? ('images/' + d.thumbnail.filename) : '';
              var bgStyle = thumb ? (' style="background-image: url(\'' + thumb + '\')"') : '';
              html += '<a class="card" href="story.html?name=' + encodeURIComponent(item.name) + '">';
              html += '<div class="card-bg"' + bgStyle + '><span class="level">' + escapeHtml(d.level || '') + '</span></div>';
              html += '<div class="card-body"><h2 class="card-title">' + escapeHtml(d.title || item.name) + '</h2>';
              if (d.titleTranslation) html += '<p class="card-meta">' + escapeHtml(d.titleTranslation) + '</p>';
              html += '</div></a>';
            });
            html += '</div>';
            app.innerHTML = html;
            app.className = '';
          });
        })
        .catch(function (e) {
          app.innerHTML = '<p class="error">Could not load manifest or story files. Open this page over HTTP (e.g. run a local server from this folder).</p>';
          app.className = '';
        });
    })();
  </script>
</body>
</html>
